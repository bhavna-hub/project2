---
title: "Project2_ver1"
author: "Bhavna Murthy"
date: "3/2/2021"
output: html_document
---
## Abstract

## Introduction
We are using two data ssets in this report; WHO Global COVID19 and GOV_Responses2COVID19. The WHO Global data set has recorded case counts and other variables from all over the world. Some variables of interest are the cumulative cases, cumulative deaths and new cases. Each row tabulates the new cases and deaths reported for each day since January 3 2020 for each country. It also updates cumulative cases and deaths. The GOV_Responses2COVID19 dataset has among others some binary variables that indicate whether a country has implemented policies such as testing and masks.

This report seeks to find out whether implementing which policy among testing, masks and lockdown before April 1 have significant effect on a countries case proportion growth rate between April and August. Testing will allow cases to be caught early enough so that people can go into isolation and prevent it being spread to other people. So it can be hypothesized that countries with testing facilities may have lower case proportion growth. Masks prevent air from flowing from one person to another. This prevents highly infectious diseases like COVID19 from spreading. Countries requiring masks would have a lower case proportion growth. Implementing a lockdown also slows the spread of COVID19.

## Background

## Decriptive Analysis
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(dplyr)
library(ggplot2)
library(reshape2)
```


```{r}
covid <- read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv")

policy <- read_excel("Data/Gov_Responses2Covid19_last.xlsx")
```

```{r}
by_country <- policy %>%
  group_by(country)

policy2 <- by_country %>%
  subset(d=='31aug2020' | d=='01apr2020')

for (x in 1:nrow(policy2)) {
  if (policy2$d[x]=='31aug2020') {
    policy2$d[x]<-'2020-08-31' 
  }
  else {
    policy2$d[x]<-'2020-4-01'
  }
} 

covid2 <- covid %>%
  subset(Date_reported=='2020-08-31' | Date_reported=='2020-04-01') 

policy2$date<-as.Date(policy2$d, "%Y-%m-%d")

policy2<-policy2 %>%
  subset(select=-c(d))

df<-merge(x=policy2, y=covid2, by.x=c("geoid", "date"), by.y=c("Country_code", "Date_reported"))
df<-df %>%
  mutate(case_proportion=(Cumulative_cases/as.numeric(population_2019))) 

df %>% mutate(masks = as.factor(masks),
             domestic = as.factor(domestic),
             testing = as.factor(testing))
df

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


Adding case mortality column
```{r}
df$Case_mort = df$Cumulative_deaths/df$Cumulative_cases
```

```{r}
head(df)
```

#summary statistics
```{r}
# earliet date
min(covid$Date_reported)
```

```{r}
# Latest date
max(covid$Date_reported)
```

```{r}
# Halfway point
median(covid$Date_reported)
```

```{r}
summary(df$cases)
```

```{r}
summary(df$deaths)
```

```{r}
summary(df$Case_mort)
```


```{r}
df[which.max(df$Case_mort),]
```


```{r}
### CREATE VARIABLE FOR CASE PROPORTION GROWTH RATE BETWEEN APRIL AND AUGUST ###
### Growth rate = (current value - lagged value) / (lagged value)

#case.growth<-((df$case_proportion[which(df$date=='2020-08-31')]-df$case_proportion[which(df$date=='2020-04-01')])/df$case_proportion[which(df$date=='2020-04-01')]) 

#df$case.growth<-rep(case.growth, each=2)

case.growth<-((df$Cumulative_cases[which(df$date=='2020-08-31')]-df$Cumulative_cases[which(df$date=='2020-04-01')])/df$Cumulative_cases[which(df$date=='2020-04-01')]) 

df$case.growth<-rep(case.growth, each=2)
```

```{r}
### GENERATE BOXPLOT FOR COUNTRIES WHICH HAD MASK POLICY IN APRIL VERSUS NO MASK POLICY IN APRIL ###

df.maskapril<-subset(df, masks==1 & date=='2020-04-01')

df.augresult<-subset(df, df$country %in% df.maskapril$country & date=='2020-08-31')

mask.result<-summary(df.augresult$case_proportion)


df.nomaskapril<-subset(df, masks==0 & date=='2020-04-01')

df.augresult.nm<-subset(df, df$country %in% df.nomaskapril$country & date=='2020-08-31')

nomask.result<-summary(df.augresult.nm$case_proportion)

boxplot(df.augresult$case.growth, df.augresult.nm$case.growth,
        names=c('Mask policy in April', 'No mask policy in April'),
        ylim=c(0, 1000),
        main='Cumulative case growth rate from Apr to Aug based on Apr 1st mask policy')
```

```{r}
### GENERATE BOXPLOT FOR COUNTRIES WHICH HAD TESTING POLICY IN APRIL VERSUS ###
### NO TESTING POLICY IN APRIL ###

df.test.april<-subset(df, testing==1 & date=='2020-04-01')

df.augresult.test<-subset(df, df$country %in% df.test.april$country & date=='2020-08-31')

test.result<-summary(df.augresult.test$case.growth)


df.notest.april<-subset(df, testing==0 & date=='2020-04-01')

df.augresult.notest<-subset(df, df$country %in% df.notest.april$country & date=='2020-08-31')

nomass.result<-summary(df.augresult.notest$case.growth)

boxplot(df.augresult.test$case.growth, df.augresult.notest$case.growth,
        names=c('Testing Policy in April', 'No Testing Policy in April'),
        ylim=c(0, 1000),
        main='Cumulative case growth rate from Apr to Aug based on Apr 1st testing policy')
```

```{r}
### GENERATE BOXPLOT FOR COUNTRIES WHICH HAD LOCKDOWN POLICY IN APRIL VERSUS ###
### NO LOCKDOWN POLICY IN APRIL ###

df.ld.april<-subset(df, domestic==1 & date=='2020-04-01')

df.augresult.ld<-subset(df, df$country %in% df.ld.april$country & date=='2020-08-31')

ld.result<-summary(df.augresult.ld$case_proportion)


df.nold.april<-subset(df, domestic==0 & date=='2020-04-01')

df.augresult.nold<-subset(df, df$country %in% df.nold.april$country & date=='2020-08-31')

nold.result<-summary(df.augresult.nold$case_proportion)

boxplot(df.augresult.ld$case.growth, df.augresult.nold$case.growth,
        names=c('Lockdown Policy in April', 'No Lockdown Policy in April'),
        ylim=c(0,1000),
        main='Cumulative case growth rate from Apr to Aug based on Apr 1st lockdown policy')

```



## Inferential Analysis
```{r}
## Created a dataframe with just the country, growth rate in August, whether mask testing, lockdown in April

# Can be used for anova model
masking_policy_april = subset(df, date =='2020-04-01')
august_results = subset(df, date == "2020-08-31")
df1 = data.frame( country =masking_policy_april$country, case_growth = august_results$case.growth, masks =masking_policy_april$masks,
                 lockdown =masking_policy_april$domestic,
                 testing =masking_policy_april$testing )
```



